{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="page-title mb-0">Analytics</h3>
    <div class="d-flex gap-2">
        <a class="btn btn-outline-primary" href="{{ url_for('transactions') }}">View transactions</a>
        <button id="exportCsvBtn" class="btn btn-outline-secondary" title="Export CSV for the current view">Export CSV
            (current)</button>
    </div>
</div>

<div class="card p-3 mb-3 shadow-sm">
    <div class="row g-2 align-items-end">
        <div class="col-md-4">
            <ul class="nav nav-tabs" id="analyticsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="graphs-tab" data-bs-toggle="tab" data-view="graphs"
                        type="button">Graphs</button>
                </li>
            </ul>
        </div>

        <!-- shared controls -->
        <div class="col-md-2">
            <label class="form-label small mb-1">From</label>
            <input id="fromDate" class="form-control form-control-sm" type="date">
        </div>

        <div class="col-md-2">
            <label class="form-label small mb-1">To</label>
            <input id="toDate" class="form-control form-control-sm" type="date">
        </div>

        <div class="col-md-2" id="periodCol">
            <label class="form-label small mb-1">Period</label>
            <select id="periodSelect" class="form-select form-select-sm">
                <option value="daily" selected>Daily</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
            </select>
        </div>

        <div class="col-md-1">
            <button id="applyBtn" class="btn btn-primary w-100">Apply</button>
        </div>
    </div>
</div>

<!-- content area -->
<div class="tab-content">
    <div class="tab-pane fade show active" id="graphsPane">
        <div class="row">
            <div class="col-lg-8">
                <div class="card p-3 mb-3 shadow-sm h-100">
                    <h5 id="chartTitle" class="card-title mb-2">Totals</h5>
                    <div class="chart-wrapper" style="height:360px;">
                        <canvas id="mainChart" role="img" aria-label="Main analytics chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card p-3 mb-3 shadow-sm h-100">
                    <h6 id="sideTitle" class="card-title mb-2">Category breakdown</h6>
                    <div class="side-chart-wrapper" style="height:360px;">
                        <canvas id="sideChart" role="img" aria-label="Category breakdown chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {# If you have a raw data pane, include it here with id="rawPane" and a table with id="rawTable" #}
</div>

<!-- summary / extra analytics -->
<div class="row g-2">
    <div class="col-md-4">
        <div class="card p-3 mb-3 shadow-sm">
            <h6 class="mb-2">Summary</h6>
            <ul class="list-unstyled mb-0" id="summaryList">
                <li>Total: <strong id="sumTotal">0.00</strong></li>
                <li>Count: <strong id="sumCount">0</strong></li>
                <li>Average: <strong id="sumAvg">0.00</strong></li>
                <li>Median: <strong id="sumMedian">0.00</strong></li>
                <li>Min: <strong id="sumMin">0.00</strong></li>
                <li>Max: <strong id="sumMax">0.00</strong></li>
                <li>Prev Period Total: <strong id="sumPrev">0.00</strong></li>
                <li>% Change vs Prev: <strong id="sumPct">N/A</strong></li>
                <li>Top Category: <strong id="sumTopCat">-</strong></li>
                <li>Largest Txn: <strong id="sumLargest">-</strong></li>
            </ul>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card p-3 mb-3 shadow-sm">
            <h6 class="mb-2">Quick insights</h6>
            <div id="insightsArea">Use the controls above and press Apply to see insights for the selected range.</div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
{% endblock %}