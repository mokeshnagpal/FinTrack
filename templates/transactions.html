{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Transactions</h3>

    {# Hide Add button for view-only mode #}
    {% if not session.get('view_only') %}
    <a class="btn btn-outline-primary" href="{{ url_for('add') }}">Add</a>
    {% endif %}
</div>

<table class="table table-sm table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
            <th class="text-end">Amount (â‚¹)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for txn in txns.items %}
        <tr>
            <td>{{ txn.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ txn.description }}</td>
            <td>{{ txn.category or 'Uncategorized' }}</td>
            <td class="text-end">{{ '%.2f'|format(txn.amount) }}</td>

            <td>

                {% if not session.get('view_only') %}

                <!-- FULL MODE: SHOW DELETE BUTTON -->
                <form method="post" action="{{ url_for('delete', tx_id=txn.id) }}" class="delete-form d-inline">

                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                        data-bs-target="#deleteModal{{ txn.id }}">
                        Delete
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="deleteModal{{ txn.id }}" tabindex="-1"
                        aria-labelledby="deleteModalLabel{{ txn.id }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content shadow-lg rounded-3 border-0">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title" id="deleteModalLabel{{ txn.id }}">
                                        Confirm Deletion
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>

                                <div class="modal-body text-center">
                                    <i class="bi bi-exclamation-triangle text-warning display-4 mb-3"></i>
                                    <p class="fw-semibold mb-1">Are you sure you want to delete this transaction?</p>
                                    <p class="text-muted small mb-0">This action cannot be undone.</p>
                                </div>

                                <div class="modal-footer d-flex justify-content-center gap-2">
                                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">
                                        Cancel
                                    </button>
                                    <button type="submit" class="btn btn-danger px-4">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                {% else %}

                <!-- VIEW-ONLY MODE: SHOW DISABLED TEXT BUTTON -->
                <button class="btn btn-sm btn-secondary" disabled title="Delete is disabled in view-only mode">
                    Delete
                </button>

                {% endif %}

            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if txns.items %}
<nav>
    <ul class="pagination">
        {% if txns.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('transactions', page=txns.prev_num) }}">Previous</a>
        </li>
        {% else %}
        <li class="page-item disabled"><a class="page-link">Previous</a></li>
        {% endif %}

        <li class="page-item active"><a class="page-link" href="#">{{ txns.page }}</a></li>

        {% if txns.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('transactions', page=txns.next_num) }}">Next</a>
        </li>
        {% else %}
        <li class="page-item disabled"><a class="page-link">Next</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% endblock %}